# IMMUNOS Daily Journal - 2025-12-25

## Session Summary

### Dashboard Debugging (Chart.js Fix)

**Problem**: IMMUNOS Monitor dashboard showing repeated "Canvas exceeds max size" errors in browser console. Tab panels appearing empty or not loading correctly.

**Root Cause**: Chart.js cannot properly size canvas elements when they are inside hidden containers (display: none). The original code called `setupCharts()` and `setupThymusChart()` during `init()` before any tabs were visible.

**Solution Implemented**:
1. Removed direct chart initialization from `init()`
2. Added `chartsInitialized` tracking object to prevent re-initialization
3. Implemented lazy chart loading in `switchTab()`:
   - Activity chart loads when Overview tab becomes visible
   - Tokens chart loads when System tab becomes visible
   - Thymus chart loads when Thymus tab becomes visible
4. Added 100ms delay to ensure DOM is fully rendered before chart init

**Files Modified**:
- `scripts/static/js/monitor.js` - Lazy chart initialization
- `scripts/templates/monitor.html` - Version string update

**Commits**:
- `fbca5d5` - Add favicon route and fix dashboard 404 errors

### Version Control Notes
- Explored git history back to `ed79cf4` (original dashboard creation)
- Original version used CDN for Tailwind, Socket.io, Chart.js
- Current version uses local vendor files
- Clean version deployed with `?v=20251225-clean` cache-bust

## Files Updated
- `/Users/byron/projects/scripts/static/js/monitor.js`
- `/Users/byron/projects/scripts/templates/monitor.html`
- `/Users/byron/projects/scripts/immunos_dashboard.py` (favicon route)
- `/Users/byron/projects/scripts/static/favicon.ico` (new)

## IMMUNOS System Updates
- Snapshot created: `snap_2025-12-25_061124`
- Memory stored: `mem_c7a5d5a7dc39775e` (high priority, conversation type)
- Dashboard running at: http://localhost:5001/monitor

## Next Steps
- [x] Test dashboard in browser with hard refresh
- [x] Verify T Cell Memory panel displays correctly
- [ ] Test file upload functionality
- [ ] Test project save/load functionality
- [ ] Confirm no more Chart.js errors in console

---

## Session 2: T Cell Memory Panel (Continued)

### Features Implemented

**T Cell Memory Panel** (`v20251225-kb4`):
1. **Project Management** - Save/Load/New projects with localStorage
   - Saves: selected models, KB files, uploaded files, active model
   - Projects persist across browser sessions

2. **File Upload** - Drag-and-drop or click to upload
   - Supports: .md, .txt, .json, .py, .js
   - Files stored in memory for session
   - Checkbox selection per file
   - Remove individual files

3. **KB Integration** - Knowledge Base files with checkboxes
   - Select All / Clear buttons
   - Files included in chat context when enabled

4. **Context Aggregation** - `getSelectedKBContext()` now includes:
   - Selected KB files from server
   - Selected uploaded files from browser
   - Shows count in chat: "[Using N context file(s): X KB + Y uploaded]"

5. **Auto-Highlight** - T Cell model (qwen2.5:7b) selection
   - Highlights memory panel with blue ring
   - Changes header to "T Cell Memory (Active)"

### Technical Notes
- **Cache Busting**: Using `?v=20251225-kb4` on script tag
- **Version Indicator**: Shows version + JS load time in header
- **Flask Restart Required**: Template changes need server restart

### Files Modified
- `/Users/byron/projects/scripts/static/js/monitor.js`
- `/Users/byron/projects/scripts/templates/monitor.html`

---

## Session 3: Recovery & Snapshot Buttons

### Features Added

**Dashboard Recovery Integration** (`v20251225-kb5`):
1. **Recover Context Button** - Runs `immunos_recover.py` from dashboard
   - Shows recovery output in chat
   - Displays recovery summary
   - Purple button in header

2. **Create Snapshot Button** - Creates snapshot from dashboard
   - Prompts for summary
   - Runs `immunos_snapshot.py create`
   - Teal button in header

3. **Auto-check on Load** - `checkRecoveryStatus()` runs on page load
   - Warns if last snapshot > 4 hours old
   - Shows snapshot name in chat

### API Endpoints Added
- `POST /api/recovery/run` - Run recovery script
- `POST /api/snapshot/create` - Create new snapshot
- `GET /api/recovery/status` - Get recovery/snapshot status

### Files Modified
- `/Users/byron/projects/scripts/immunos_api.py` - Added recovery endpoints
- `/Users/byron/projects/scripts/static/js/monitor.js` - Recovery/snapshot functions
- `/Users/byron/projects/scripts/templates/monitor.html` - Added buttons

---

## Session 4: KB Wiki & Documentation

### Features Implemented

**KB Wiki Page** (`/kb`):
- Full-page wiki with sidebar navigation
- Search/filter documents
- Markdown rendering (marked.js)
- Create/edit user pages (saved to `~/.immunos/kb/`)
- Upload `.md`/`.txt` files
- User pages override system pages

**KB Documentation Added**:
- `immunos-architecture.md` - System/user separation
- `immunos-packaging.md` - pip/brew/npm/apt/rpm standards
- `immunos-publications.md` - IEEE citations, datasets
- `immunos-dashboard.md` - Button/panel documentation
- `index.md` - KB overview

### Commits This Session
- `5db8ca3` feat(kb): Add full Knowledge Base wiki page with user editing
- `ab96e02` feat(dashboard): Add Knowledge Base viewer button and modal
- `f0a8c31` docs(kb): Add comprehensive packaging standards for all platforms
- `2467683` docs(kb): Add installation architecture for system/user separation
- `ff1fb06` docs(kb): Add comprehensive dashboard and publications documentation
- `ee4e6a0` feat(dashboard): Add T Cell Memory panel and recovery integration

### Dashboard Version
`v20251225-kb8`

### URLs
- Dashboard: http://localhost:5001/monitor
- KB Wiki: http://localhost:5001/kb

### Snapshots Created
- `snap_2025-12-25_142852` - Dashboard v20251225-kb5
- `snap_2025-12-25_142943` - T Cell Memory panel + Recovery buttons
- `snap_2025-12-25_143601` - Dashboard docs, publications
- `snap_2025-12-25_143746` - Architecture docs
- `snap_2025-12-25_144151` - Packaging standards
- `snap_2025-12-25_145019` - KB Wiki page

---
*Session with Claude Opus 4.5 via Claude Code*
